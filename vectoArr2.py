#__________________IMPORTS_________________________________________________________
import io
import os
import sys
import shutil
import numpy as np
import pandas as pd
from collections import defaultdict

#__________________MAIN_________________________________________________________


#obtain list of vector files
files = []
for r, d, f in os.walk("Chivecs/"):
    for file in f:
	    if '.csv' in file:
		    files.append(os.path.join(r, file))

#obtain feature and sample labels
feats = pd.read_csv("o330Chi6g.csv", dtype=str, header=None).to_numpy()
labels = pd.read_csv("trainLabels.csv").to_numpy()

#make dictionary with filename as key and label as value
ld = defaultdict(list)
for k, v in labels:
    ld["Chivecs/"+k+".csv"].append(v)

numFeats = len(feats)
numSamps = len(files)

#output feature vectors with new lines delimiting feature vectors and commas delimiting feature values
out = open("ChiArr.csv", "w") #will contain entire feature array as csv
lbls= open("ChiLabels.csv", "w")
buf = io.StringIO()
for i in range(numSamps):
	vec = pd.read_csv(files[i], header=None, dtype=int).to_numpy()
	for j in range(len(vec)-1):
		buf.write(str(vec[j, 0])+",")
	buf.write(str(vec[j+1,0])+"\n")
	buf.seek(0)
	shutil.copyfileobj(buf, out)
	buf.close()
	buf = io.StringIO()
	lbls.write(str(ld[files[i]])[1]+"\n")
buf.close()
out.close()
lbls.close()
